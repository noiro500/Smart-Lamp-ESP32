# Контроллер лампы SmartLampESP32

Контроллер электронных устройств SmartLampESP32 представляет из себя устройство, которое может выполнять следующие действия:

*   Подключаться к сети WiFi в режиме WiFi\_STA (лампа подключается у точке доступа).
*   Выступать в режиме WiFi\_AP (лампа сама выступает в роли точки доступа).
*   Включать и выключать электрические приботы по команде.
*   Включать и выключать алектрические приботы по таймеру.
*   Измерять температуру и влажность.
*   Измерять и сохранять температуру и влажность в течении суток.
*   Получать время с сервера времени ntp.

В настоящий момент контроллер используется для контроля фитолампы.

## Подготовка к использованию

В проекте используются:

*   Плата ESP32 WeMos LOLIN32 Lite.
*   Цифровой датчик температуры и влажности Aosong AM2320.
*   Модуль реле для коммутации нагрузки 110/220 вольт

Подключить датчик AM2320 к соответствующим пинам платы микроконтроллера. Так как используется плата ESP32 WeMos LOLIN32 Lite, то это следующие пины: SDA - 19, SCL - 23 (для других плат ESP32 пины могут отличаться). Подключить питание к AM2320. Подключить модуль реле к соответствующи пинам (по умолчанию In или Sig к пину 23, пины питания VCC и GND)  

**Внимание:** если датчик AM2320 не передает показания, то, вероятно, в нем отсутствуют резисторы на выводах SDA и SCL.  Необходимо подключить резистор 10КОм параллельно выходу SDA и SCA AM2320 и плюсом питания VCC.

![ESP32 AM2320](Image//ConnectAM2320.png)

### Настройка прошивки

Откройте файл GeneralParameters.h и настройте параметры конфигурации по умолчанию:

```cpp
#define WIFI_MODE "WIFI_STA"                        // Режим работы ESP32 WiFi (WIFI_AP, WIFI_STA)
#define WIFI_AP_IP {192, 168, 4, 1}                 // WIFI_AP IP
#define WIFI_AP_NETMASK {255, 255, 255, 0}          // WIFI_AP Маска подсети
#define PASSWORD "123456789"                        // Пароль WIFI_AP and WIFI_STA
#define WIFI_AP_SSID "CactusLampESP32"              // Ssid for WIFI_AP
#define WIFI_STA_SSID "Wi_Fi_Station"               // Ssid for WIFI_STA
#define LAMP_OLWAYS_ON 0                            // Лампа всегда включена? (0 - нет, 1 - да)
#define LAMP_ON_HOUR 8                              // Час включения лампы (0 до 23)
#define LAMP_OFF_HOUR 22                            // Час выключения лампы (0 до 23) 

#define TIMEZONE 3                                  // Временная зона (например UTC 0), hour
#define DAYLIGHTOFFSET 0 * 60 * 60                  // Смещение летнего времени (0 - нет перехода на летнее время)
#define NTP_SERVER "ntp0.ntp-servers.net"           //Сервер времени
#define SDA_PIN 19                                  //SDA пин
#define SCL_PIN 23                                  //SCL пин                            
#define RELAY_LAMP_PIN 22                           //Lamp relay connection pin
```

Загрузите код в плату ESP32